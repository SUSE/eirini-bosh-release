---
apiVersion: batch/v1
kind: Job
metadata:
  name: cert-copier
spec:
  template:
    spec:
      serviceAccountName: "eirini"
      restartPolicy: Never
      containers:
      - name: copy-certs
        env:
        - name: INTERNAL_CA_CERT
          valueFrom:
            secretKeyRef:
              key: internal-ca-cert
              name: "<%= p('opi.certs_secret_name') %>"
        - name: REGISTRY
          value: "<%= p('opi.registry_address') %>"
        - name: SCF_NAMESPACE
          valueFrom:
            fieldRef:
              fieldPath: metadata.namespace
        image: "<%= p('eirini.cert_copier_image') %>"
        volumeMounts:
        - name: host-docker
          mountPath: /workspace/docker
      volumes:
      - name: host-docker
        hostPath:
          path: /etc/docker
          type: Directory
